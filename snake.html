<!DOCTYPE html>
<html>
    <head>
        <title>Snake</title>
        <style>

        </style>
    </head>
    <body>
        <canvas id="canvas" width=1024 height=1024></canvas> <br/>
        <script>
	    var jatek = {
            tickSzama: 0,
            idozito: null,
            tabla: [
                        "###############",
                        "#             #",
                        "#             #",
                        "#             #",
                        "#    ####     #",
                        "#    ####     #",
                        "#             #",
                        "#             #",
                        "#             #",
                        "###############"
                    ],
            tick: function() {
                window.clearTimeout(jatek.idozito);
                jatek.tickSzama++;
                kigyo.mozgas();
                grafika.jatekMegRajzolas();
                jatek.idozito = window.setTimeout("jatek.tick()", 500);
            }
	    };
        var kigyo = {
            reszek: [
                {x: 4, y: 2},
                {x: 3, y: 2},
                {x: 2, y: 2}
            ],
            irany: "E",
            kovetkezoHely: function() {
                var kigyoFej = kigyo.reszek[0];
                var cellX = kigyoFej.x;
                var cellY = kigyoFej.y;
                cellY = kigyo.irany == "N" ? cellY-1 : cellY;
                cellY = kigyo.irany == "S" ? cellY+1 : cellY;
                cellX = kigyo.irany == "W" ? cellX-1 : cellX;
                cellX = kigyo.irany == "E" ? cellX+1 : cellX;
                return {x: cellX, y: cellY};
            },
            mozgas: function() {
                var hely = kigyo.kovetkezoHely();
                kigyo.reszek.unshift(hely);
                kigyo.reszek.pop();
            }
	    };
	    var grafika = {
            canvas: document.getElementById("canvas"),
            negyzetMeret: 30,
		    tablaMegRajzolas: function(ctx) {
		        aktualisYOffset = 0;
		        jatek.tabla.forEach(function sorEllenorzes(sor) {
                    sor = sor.split("");
                    var aktualisXOffset = 0;
                    sor.forEach(function karakterEllenorzes(karakter) {
                        if(karakter == "#") {
                            ctx.fillStyle = "black";
                            ctx.fillRect(aktualisXOffset, aktualisYOffset, grafika.negyzetMeret, grafika.negyzetMeret);
                        }
                        aktualisXOffset += grafika.negyzetMeret;
                    });
                    aktualisYOffset += grafika.negyzetMeret;
                });
		    },
		    kigyoMegRajzolas: function(ctx) {
                kigyo.reszek.forEach(function reszMegRajzolas(resz) {
                    var reszXHelye = resz.x * grafika.negyzetMeret;
                    var reszYHelye = resz.y * grafika.negyzetMeret;
                    ctx.fillStyle = "green";
                    ctx.fillRect(reszXHelye, reszYHelye, grafika.negyzetMeret, grafika.negyzetMeret);
		        });
		    },
            jatekMegRajzolas: function() {
                var ctx = grafika.canvas.getContext("2d");
                ctx.clearRect(0, 0, grafika.canvas.width, grafika.canvas.height);
                grafika.tablaMegRajzolas(ctx);
                grafika.kigyoMegRajzolas(ctx);
            }

	    };
	    grafika.jatekMegRajzolas();
	    var jatekIranyitas = {
            beviteliEsemeny: function(lenyomottBillentyu) {
                var key = lenyomottBillentyu.key.toLowerCase();
                var celIrany = kigyo.irany;
                if(key == "w") celIrany = "N";
                if(key == "a") celIrany = "W";
                if(key == "s") celIrany = "S";
                if(key == "d") celIrany = "E";
                kigyo.irany = celIrany;
                jatek.tick();
            },
		    jatekInditas: function() {
                window.addEventListener("keypress", jatekIranyitas.beviteliEsemeny, false);
		        jatek.tick();
		    }
	    };
	    jatekIranyitas.jatekInditas();
	 </script>
    </body>
</html>
